{"ast":null,"code":"import _regeneratorRuntime from\"/home/meriam/testwapp/WApplication/Partie Client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/meriam/testwapp/WApplication/Partie Client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/meriam/testwapp/WApplication/Partie Client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useRef,useState,useEffect}from'react';import IconButton from'@material-ui/core/Button';import StopIcon from'@material-ui/icons/Stop';import{makeStyles}from'@material-ui/styles';import FlipCameraIosIcon from'@material-ui/icons/FlipCameraIos';var styles=makeStyles(function(theme){return{icon:{fontSize:'2.2rem',color:'#5336B7'}};});export default function Camera(props){var _useState=useState(useRef()),_useState2=_slicedToArray(_useState,2),videoRef=_useState2[0],setVideoRef=_useState2[1];var classes=styles();var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),blob=_useState4[0],setBlob=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),mediaStream=_useState6[0],setMediaStream=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),mediaRecorder=_useState8[0],setMediaRecorder=_useState8[1];var _useState9=useState(0),_useState10=_slicedToArray(_useState9,2),time=_useState10[0],setTime=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),videoRecorded=_useState12[0],setVideoRecorded=_useState12[1];var _useState13=useState(null),_useState14=_slicedToArray(_useState13,2),playableVideo=_useState14[0],setPlayableVideo=_useState14[1];var _useState15=useState(null),_useState16=_slicedToArray(_useState15,2),camIndex=_useState16[0],setCamIndex=_useState16[1];var _useState17=useState(1),_useState18=_slicedToArray(_useState17,2),camCount=_useState18[0],setCamCount=_useState18[1];var onRecordingComplete=props.onRecordingComplete;var _useState19=useState(true),_useState20=_slicedToArray(_useState19,2),canPlay=_useState20[0],setCanPlay=_useState20[1];//l'ouverture dde la cam \nvar openCam=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(index){var devices,videoDevices,CAPTURE_OPTIONS,stream,recorder;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setCamIndex(index);_context.next=3;return navigator.mediaDevices.enumerateDevices();case 3:devices=_context.sent;videoDevices=devices.filter(function(e){return e.kind==='videoinput';});setCamCount(videoDevices.length);CAPTURE_OPTIONS={audio:'default',video:{facingMode:\"environment\",deviceId:videoDevices[index].deviceId}};_context.next=9;return navigator.mediaDevices.getUserMedia(CAPTURE_OPTIONS);case 9:stream=_context.sent;setMediaStream(stream);videoRef.current.srcObject=stream;recorder=new window.MediaRecorder(stream);setMediaRecorder(recorder);setCanPlay(true);case 15:case\"end\":return _context.stop();}}},_callee);}));return function openCam(_x){return _ref.apply(this,arguments);};}();useEffect(function(){openCam(0);},[]);useEffect(function(){if(mediaStream&&videoRef.current&&!videoRef.current.srcObject){videoRef.current.srcObject=mediaStream;var recorder=new window.MediaRecorder(mediaStream);setMediaRecorder(recorder);setCanPlay(true);}},[mediaStream]);useEffect(function(){if(mediaRecorder){var ondataavailable=function ondataavailable(e){blob.push(e.data);};mediaRecorder.ondataavailable=ondataavailable;mediaRecorder.start(10);}},[mediaRecorder]);function handleCanPlay(){videoRef.current.play();}var MIME_TYPES=['video/webm;codecs=\"vp8,opus\"','video/webm;codecs=h264','video/webm;codecs=vp9','video/webm'];var getMimeType=function getMimeType(){var mimeType=window.MediaRecorder.isTypeSupported?MIME_TYPES.find(window.MediaRecorder.isTypeSupported):'video/webm';return mimeType||'';};var handleStop=function handleStop(){var videoBlob=blob.length===1?blob[0]:new window.Blob(blob,{type:getMimeType()});props.onRecordingComplete(videoBlob);setVideoRecorded(true);setPlayableVideo(URL.createObjectURL(videoBlob));if(mediaRecorder.state==='recording'){mediaRecorder.stop();}};var flipCamera=function flipCamera(){mediaStream.getTracks().forEach(function(track){track.stop();});mediaRecorder.stop();var i=(camIndex+1)%camCount;videoRef.current.load();delete videoRef.current.srcObject;// empty source\nopenCam(i);};return/*#__PURE__*/React.createElement(\"div\",null,videoRecorded&&playableVideo?/*#__PURE__*/React.createElement(\"video\",{width:\"100%\",src:playableVideo,autoPlay:true,playsInline:true,controls:true}):/*#__PURE__*/React.createElement(\"div\",null,canPlay&&/*#__PURE__*/React.createElement(\"video\",{width:\"100%\",ref:videoRef,onCanPlay:handleCanPlay,autoPlay:true,playsInline:true}),camCount>1&&/*#__PURE__*/React.createElement(IconButton,{onClick:flipCamera},/*#__PURE__*/React.createElement(FlipCameraIosIcon,{classes:{root:classes.icon}})),/*#__PURE__*/React.createElement(IconButton,{onClick:handleStop},/*#__PURE__*/React.createElement(StopIcon,{classes:{root:classes.icon}}))));}","map":{"version":3,"sources":["/home/meriam/testwapp/WApplication/Partie Client/src/views/recorder/recordrtc-react/src/RecordPage.react.js"],"names":["React","useRef","useState","useEffect","IconButton","StopIcon","makeStyles","FlipCameraIosIcon","styles","theme","icon","fontSize","color","Camera","props","videoRef","setVideoRef","classes","blob","setBlob","mediaStream","setMediaStream","mediaRecorder","setMediaRecorder","time","setTime","videoRecorded","setVideoRecorded","playableVideo","setPlayableVideo","camIndex","setCamIndex","camCount","setCamCount","onRecordingComplete","canPlay","setCanPlay","openCam","index","navigator","mediaDevices","enumerateDevices","devices","videoDevices","filter","e","kind","length","CAPTURE_OPTIONS","audio","video","facingMode","deviceId","getUserMedia","stream","current","srcObject","recorder","window","MediaRecorder","ondataavailable","push","data","start","handleCanPlay","play","MIME_TYPES","getMimeType","mimeType","isTypeSupported","find","handleStop","videoBlob","Blob","type","URL","createObjectURL","state","stop","flipCamera","getTracks","forEach","track","i","load","root"],"mappings":"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","sourcesContent":["import React, { useRef, useState, useEffect } from 'react';\nimport IconButton from '@material-ui/core/Button';\nimport StopIcon from '@material-ui/icons/Stop';\nimport { makeStyles } from '@material-ui/styles';\nimport FlipCameraIosIcon from '@material-ui/icons/FlipCameraIos';\nconst styles = makeStyles((theme) => ({\n  icon:{\n    fontSize: '2.2rem',\n    color: '#5336B7',\n},\n})\n)\n\nexport default function Camera(props) {\n  const [videoRef, setVideoRef] = useState(useRef());\n  const classes = styles()\n  const [blob, setBlob] = useState([]);\n  const [mediaStream, setMediaStream] = useState(null);\n  const [mediaRecorder, setMediaRecorder] = useState(null);\n  const [time, setTime] = useState(0);\n  const [videoRecorded, setVideoRecorded] = useState(false);\n  const [playableVideo, setPlayableVideo] = useState(null);\n  const [camIndex, setCamIndex] = useState(null);\n  const [camCount, setCamCount] = useState(1);\n  const { onRecordingComplete } = props;\n  const [canPlay, setCanPlay] = useState(true);\n  //l'ouverture dde la cam \n  const openCam = async (index) => {\n    setCamIndex(index);\n    const devices = await navigator.mediaDevices.enumerateDevices();\n    const videoDevices = devices.filter(e => e.kind === 'videoinput');\n    setCamCount(videoDevices.length)\n    const CAPTURE_OPTIONS = {\n      audio: 'default',\n      video: { facingMode: \"environment\", deviceId: videoDevices[index].deviceId },\n    };\n    const stream = await navigator.mediaDevices.getUserMedia(CAPTURE_OPTIONS);\n    setMediaStream(stream);\n    videoRef.current.srcObject = stream;\n    const recorder = new window.MediaRecorder(stream);\n    setMediaRecorder(recorder);\n    setCanPlay(true); \n  }\n  useEffect(() =>{\n    openCam(0);\n  }, [])\n  \n  useEffect(() =>{\n    if (mediaStream && videoRef.current && !videoRef.current.srcObject) {\n      videoRef.current.srcObject = mediaStream;\n      const recorder = new window.MediaRecorder(mediaStream);\n      setMediaRecorder(recorder);\n      setCanPlay(true);\n    }\n    }, [mediaStream])\n  useEffect(() =>{\n    if(mediaRecorder) {\n      const ondataavailable = (e) => {\n        blob.push(e.data)\n      };\n      mediaRecorder.ondataavailable = ondataavailable;\n      mediaRecorder.start(10)\n    }  \n  }, [mediaRecorder])\n  function handleCanPlay() {\n    videoRef.current.play();\n  }\n\n  const MIME_TYPES = [\n    'video/webm;codecs=\"vp8,opus\"',\n    'video/webm;codecs=h264',\n    'video/webm;codecs=vp9',\n    'video/webm'\n  ]\n  \n  const getMimeType = () => {\n    const mimeType = window.MediaRecorder.isTypeSupported\n      ? MIME_TYPES.find(window.MediaRecorder.isTypeSupported)\n      : 'video/webm'\n\n    return mimeType || ''\n  }\n\n  const handleStop = () => {\n    const videoBlob =\n    blob.length === 1\n      ? blob[0]\n      : new window.Blob(blob, {\n        type: getMimeType()\n      })\n    \n\n    props.onRecordingComplete(videoBlob);\n    setVideoRecorded(true);\n    setPlayableVideo(URL.createObjectURL(videoBlob));\n    if(mediaRecorder.state === 'recording') {\n      mediaRecorder.stop();\n    }\n  };\n  const flipCamera = () => {\n    mediaStream.getTracks().forEach(track => {\n      track.stop();\n    });\n    mediaRecorder.stop();  \n    const i = (camIndex + 1) % camCount;\n    videoRef.current.load();\n    delete videoRef.current.srcObject; // empty source\n    openCam(i)\n  }\n  return (\n    <div>\n      {(videoRecorded && playableVideo) ?\n      <video width=\"100%\" src={playableVideo} autoPlay playsInline controls/>\n        :\n        <div>\n      { canPlay &&\n      <video width=\"100%\" ref={videoRef} onCanPlay={handleCanPlay} autoPlay playsInline />\n      }\n      {camCount > 1 &&\n      <IconButton onClick={flipCamera}>\n            <FlipCameraIosIcon classes={{root:classes.icon}}/>\n          </IconButton>\n      }\n        <IconButton onClick={handleStop}>\n            <StopIcon classes={{root:classes.icon}}/>\n          </IconButton>\n      </div>}\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}